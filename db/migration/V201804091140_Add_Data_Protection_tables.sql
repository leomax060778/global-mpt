--************ Create USER_DATA_PROTECTION_STATUS table ************

-- 1: Pending, 2: Approved, 3: Rejected
CREATE COLUMN TABLE USER_DATA_PROTECTION_STATUS(
	USER_DATA_PROTECTION_STATUS_ID BIGINT NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	NAME NVARCHAR(255) NOT NULL,
	
	ENABLED TINYINT DEFAULT 1,
	DELETED TINYINT DEFAULT 0,
	
	CREATED_USER_ID BIGINT NOT NULL,
	MODIFIED_USER_ID BIGINT,
	CREATED_DATE_TZ TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	MODIFIED_DATE_TZ TIMESTAMP,
	
	FOREIGN KEY ( "CREATED_USER_ID" ) REFERENCES "MKTG_PLANNING_TOOL"."USER" ("USER_ID")	
);

--************ Populate Table ************

INSERT INTO "MKTG_PLANNING_TOOL"."USER_DATA_PROTECTION_STATUS"(	
																USER_DATA_PROTECTION_STATUS_ID, 
																NAME, 
																CREATED_USER_ID
																)
	VALUES(1, 'Pending', 1);
	
INSERT INTO "MKTG_PLANNING_TOOL"."USER_DATA_PROTECTION_STATUS"(	
															USER_DATA_PROTECTION_STATUS_ID, 
															NAME, 
															CREATED_USER_ID
															)
	VALUES(2, 'Approved', 1);

INSERT INTO "MKTG_PLANNING_TOOL"."USER_DATA_PROTECTION_STATUS"(	
															USER_DATA_PROTECTION_STATUS_ID, 
															NAME, 
															CREATED_USER_ID
															)
	VALUES(3, 'Rejected', 1);

--************ Create USER_DATA_PROTECTION_STATUS table ************

CREATE COLUMN TABLE USER_DATA_PROTECTION(
	USER_DATA_PROTECTION_ID BIGINT NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	USER_ID BIGINT NOT NULL,
	USER_DATA_PROTECTION_STATUS_ID BIGINT DEFAULT 1, --Pending
	
	ENABLED TINYINT DEFAULT 1,
	DELETED TINYINT DEFAULT 0,
	
	CREATED_USER_ID BIGINT NOT NULL,
	MODIFIED_USER_ID BIGINT,
	CREATED_DATE_TZ TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	MODIFIED_DATE_TZ TIMESTAMP,

	FOREIGN KEY ( "USER_ID" ) REFERENCES "MKTG_PLANNING_TOOL"."USER" ("USER_ID"),
	FOREIGN KEY ( "CREATED_USER_ID" ) REFERENCES "MKTG_PLANNING_TOOL"."USER" ("USER_ID"),
	FOREIGN KEY ( "USER_DATA_PROTECTION_STATUS_ID" ) REFERENCES "MKTG_PLANNING_TOOL"."USER_DATA_PROTECTION_STATUS" ("USER_DATA_PROTECTION_STATUS_ID")
);

-- *************************************************************************************
-- Update schema version
INSERT INTO SCHEMA_VERSION(VERSION, DESCRIPTION, SCRIPT)
VALUES('V5.0.0-137', 'Add Data Protection Tables', 'V201804091140_Add_Data_Protection_tables.sql');

COMMIT;