CREATE COLUMN TABLE DYNAMIC_FORM_MY_BUDGET (
    DYNAMIC_FORM_MY_BUDGET_ID BIGINT NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    DYNAMIC_FORM_ID BIGINT NOT NULL,
    REGION_ID BIGINT NULL,
    PERCENTAGE DECIMAL(19,2),
    CREATED_DATE_TZ TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	MODIFIED_DATE_TZ TIMESTAMP,
	CREATED_USER_ID BIGINT NOT NULL,
	MODIFIED_USER_ID BIGINT,
	ENABLED TINYINT DEFAULT 1,
	DELETED TINYINT DEFAULT 0,
	FOREIGN KEY (DYNAMIC_FORM_ID) REFERENCES "MKTG_PLANNING_TOOL"."DYNAMIC_FORM"(DYNAMIC_FORM_ID),
    FOREIGN KEY (CREATED_USER_ID) REFERENCES "MKTG_PLANNING_TOOL"."USER"(USER_ID)
);

insert into "MKTG_PLANNING_TOOL"."DYNAMIC_FORM_FIELD"(FIELD_NAME, FIELD_DISPLAY_NAME, HIERARCHY_LEVEL_ID, MANDATORY, ORDER_NUMBER, FIELD_TYPE, FIELD_KEY, DYNAMIC_FORM_TAB_ID, CREATED_USER_ID)
    values ('MY_BUDGET','MY BUDGET',2,0,2,'table',NULL,(select DYNAMIC_FORM_TAB_ID from DYNAMIC_FORM_TAB where HIERARCHY_LEVEL_ID = 2 and TAB_NAME = 'BUDGET_SPEND_REQUEST'),1);

insert into "MKTG_PLANNING_TOOL"."DYNAMIC_FORM_FIELD"(FIELD_NAME, FIELD_DISPLAY_NAME, HIERARCHY_LEVEL_ID, MANDATORY, ORDER_NUMBER, FIELD_TYPE, FIELD_KEY, DYNAMIC_FORM_TAB_ID, CREATED_USER_ID)
    values ('MY_BUDGET','MY BUDGET',3,0,2,'table',NULL,(select DYNAMIC_FORM_TAB_ID from DYNAMIC_FORM_TAB where HIERARCHY_LEVEL_ID = 3 and TAB_NAME = 'BUDGET_SPEND_REQUEST'),1);

-- *************************************************************************************
-- Update schema version
INSERT INTO SCHEMA_VERSION(VERSION, DESCRIPTION, SCRIPT)
VALUES('V5.0.0-171', 'Support Dynamic Form Region Distribution', 'V201810291700__Support_Dynamic_Form_Region_Distribution.sql');

COMMIT;