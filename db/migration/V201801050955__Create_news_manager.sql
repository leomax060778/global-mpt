--***************************************************************************************
-- Create News Status Table
CREATE COLUMN TABLE NEWS_STATUS(
	NEWS_STATUS_ID  BIGINT NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	NAME NVARCHAR(255) NOT NULL,
	DESCRIPTION NVARCHAR(500),

	CREATED_DATE_TZ  TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	MODIFIED_DATE_TZ TIMESTAMP ,
	CREATED_USER_ID BIGINT NOT NULL,
	MODIFIED_USER_ID BIGINT NULL,
	ENABLED TINYINT NULL DEFAULT 1,
	DELETED TINYINT NULL DEFAULT 0
);

--***************************************************************************************
-- Insert data to News Status Table

INSERT INTO NEWS_STATUS(NAME, CREATED_USER_ID) VALUES ('Pending', 1);
INSERT INTO NEWS_STATUS(NAME, CREATED_USER_ID) VALUES ('Archive', 1);
INSERT INTO NEWS_STATUS(NAME, CREATED_USER_ID) VALUES ('Published', 1);

--***************************************************************************************
-- Create News Table

CREATE COLUMN TABLE NEWS(
	NEWS_ID BIGINT NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	TITLE NVARCHAR(255) NOT NULL,
	DESCRIPTION NVARCHAR(2000) NOT NULL,
	ATTACHMENT_ID BIGINT NULL,

	STATUS_ID BIGINT DEFAULT 1,
	PREVIOUS_STATUS_ID BIGINT,
	USER_ID_STATUS BIGINT,
	UPDATE_STATUS_TZ TIMESTAMP,

	AUTHOR_ID BIGINT NOT NULL,
	DISPLAY_CREATED_DATE TIMESTAMP NOT NULL,
	PUBLISHED_DATE TIMESTAMP,
	BUDGET_YEAR_ID BIGINT NOT NULL,
	CONTENT TEXT NOT NULL,

	CREATED_DATE_TZ  TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	MODIFIED_DATE_TZ TIMESTAMP ,
	CREATED_USER_ID BIGINT NOT NULL,
	MODIFIED_USER_ID BIGINT NULL,
	ENABLED TINYINT NULL DEFAULT 1,
	DELETED TINYINT NULL DEFAULT 0
)
;
ALTER TABLE "MKTG_PLANNING_TOOL"."NEWS" ADD FOREIGN KEY ( "AUTHOR_ID" ) REFERENCES "MKTG_PLANNING_TOOL"."USER" ("USER_ID") ON UPDATE RESTRICT ON DELETE RESTRICT
;
ALTER TABLE "MKTG_PLANNING_TOOL"."NEWS" ADD FOREIGN KEY ( "STATUS_ID" ) REFERENCES "MKTG_PLANNING_TOOL"."NEWS_STATUS" ("NEWS_STATUS_ID") ON UPDATE RESTRICT ON DELETE RESTRICT
;
ALTER TABLE "MKTG_PLANNING_TOOL"."NEWS" ADD FOREIGN KEY ( "PREVIOUS_STATUS_ID" ) REFERENCES "MKTG_PLANNING_TOOL"."NEWS_STATUS" ("NEWS_STATUS_ID") ON UPDATE RESTRICT ON DELETE RESTRICT
;
ALTER TABLE "MKTG_PLANNING_TOOL"."NEWS" ADD FOREIGN KEY ( "BUDGET_YEAR_ID" ) REFERENCES "MKTG_PLANNING_TOOL"."BUDGET_YEAR" ("BUDGET_YEAR_ID") ON UPDATE RESTRICT ON DELETE RESTRICT
;

--***************************************************************************************
-- Create Read News Table

CREATE COLUMN TABLE "MKTG_PLANNING_TOOL"."READ_NEWS"
(
	READ_NEWS_ID BIGINT NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	USER_ID BIGINT NOT NULL,
	NEWS_ID BIGINT NOT NULL,

	CREATED_DATE_TZ TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	MODIFIED_DATE_TZ TIMESTAMP,
	CREATED_USER_ID BIGINT NOT NULL,
	MODIFIED_USER_ID BIGINT,
	ENABLED TINYINT DEFAULT 1,
	DELETED TINYINT DEFAULT 0
);
ALTER TABLE "MKTG_PLANNING_TOOL"."READ_NEWS" ADD FOREIGN KEY ( "USER_ID" ) REFERENCES "MKTG_PLANNING_TOOL"."USER" ("USER_ID") ON UPDATE RESTRICT ON DELETE RESTRICT
;
ALTER TABLE "MKTG_PLANNING_TOOL"."READ_NEWS" ADD FOREIGN KEY ( "NEWS_ID" ) REFERENCES "MKTG_PLANNING_TOOL"."NEWS" ("NEWS_ID") ON UPDATE RESTRICT ON DELETE RESTRICT
;

--***************************************************************************************
-- Create resource for News Flash and News Manager

INSERT INTO "MKTG_PLANNING_TOOL"."RESOURCE"(RESOURCE_ID, NAME,CREATED_USER_ID,OBJECT_NAME)VALUES(17, 'News Viewer',1,'newsViewer');
INSERT INTO "MKTG_PLANNING_TOOL"."RESOURCE"(RESOURCE_ID, NAME,CREATED_USER_ID,OBJECT_NAME)VALUES(18, 'News Manager',1,'newsManager');

--***************************************************************************************
-- Add permissions for SuperAdmin

-- Permission to View/Read the News Flash
INSERT INTO "MKTG_PLANNING_TOOL"."ROLE_PERMISSION"(role_id, resource_id, permission_id, created_user_id) VALUES(1, 17, 9, 1);

-- Permission to Create/Edit to mark as read in News Flash
INSERT INTO "MKTG_PLANNING_TOOL"."ROLE_PERMISSION"(role_id, resource_id, permission_id, created_user_id) VALUES(1, 17, 10, 1);

-- Permission to View/Read the News Manager
INSERT INTO "MKTG_PLANNING_TOOL"."ROLE_PERMISSION"(role_id, resource_id, permission_id, created_user_id) VALUES(1, 18, 9, 1);

-- Permission to Create/Edit News in News Manager
INSERT INTO "MKTG_PLANNING_TOOL"."ROLE_PERMISSION"(role_id, resource_id, permission_id, created_user_id) VALUES(1, 18, 10, 1);

-- Permission to Delete News in News Manager
INSERT INTO "MKTG_PLANNING_TOOL"."ROLE_PERMISSION"(role_id, resource_id, permission_id, created_user_id) VALUES(1, 18, 11, 1);

--***************************************************************************************
-- Add permissions for Admin

-- Permission to View/Read the News Flash
INSERT INTO "MKTG_PLANNING_TOOL"."ROLE_PERMISSION"(role_id, resource_id, permission_id, created_user_id) VALUES(2, 17, 9, 1);

-- Permission to Create/Edit to mark as read in News Flash
INSERT INTO "MKTG_PLANNING_TOOL"."ROLE_PERMISSION"(role_id, resource_id, permission_id, created_user_id) VALUES(2, 17, 10, 1);

-- Permission to View/Read the News Manager
INSERT INTO "MKTG_PLANNING_TOOL"."ROLE_PERMISSION"(role_id, resource_id, permission_id, created_user_id) VALUES(2, 18, 9, 1);

-- Permission to Create/Edit News in News Manager
INSERT INTO "MKTG_PLANNING_TOOL"."ROLE_PERMISSION"(role_id, resource_id, permission_id, created_user_id) VALUES(2, 18, 10, 1);

-- Permission to Delete News in News Manager
INSERT INTO "MKTG_PLANNING_TOOL"."ROLE_PERMISSION"(role_id, resource_id, permission_id, created_user_id) VALUES(2, 18, 11, 1);

--***************************************************************************************
-- Add permissions for Data Entry

-- Permission to View/Read the News Flash
INSERT INTO "MKTG_PLANNING_TOOL"."ROLE_PERMISSION"(role_id, resource_id, permission_id, created_user_id) VALUES(3, 17, 9, 1);

-- Permission to Create/Edit to mark as read in News Flash
INSERT INTO "MKTG_PLANNING_TOOL"."ROLE_PERMISSION"(role_id, resource_id, permission_id, created_user_id) VALUES(3, 17, 10, 1);

-- Permission to View/Read the News Manager
INSERT INTO "MKTG_PLANNING_TOOL"."ROLE_PERMISSION"(role_id, resource_id, permission_id, created_user_id, enabled) VALUES(3, 18, 9, 1, 0);

-- Permission to Create/Edit News in News Manager
INSERT INTO "MKTG_PLANNING_TOOL"."ROLE_PERMISSION"(role_id, resource_id, permission_id, created_user_id, enabled) VALUES(3, 18, 10, 1, 0);

-- Permission to Delete News in News Manager
INSERT INTO "MKTG_PLANNING_TOOL"."ROLE_PERMISSION"(role_id, resource_id, permission_id, created_user_id, enabled) VALUES(3, 18, 11, 1, 0);

--***************************************************************************************
-- Add permissions for Campaign Manager

-- Permission to View/Read the News Flash
INSERT INTO "MKTG_PLANNING_TOOL"."ROLE_PERMISSION"(role_id, resource_id, permission_id, created_user_id) VALUES(4, 17, 9, 1);

-- Permission to Create/Edit to mark as read in News Flash
INSERT INTO "MKTG_PLANNING_TOOL"."ROLE_PERMISSION"(role_id, resource_id, permission_id, created_user_id) VALUES(4, 17, 10, 1);

-- Permission to View/Read the News Manager
INSERT INTO "MKTG_PLANNING_TOOL"."ROLE_PERMISSION"(role_id, resource_id, permission_id, created_user_id, enabled) VALUES(4, 18, 9, 1, 0);

-- Permission to Create/Edit News in News Manager
INSERT INTO "MKTG_PLANNING_TOOL"."ROLE_PERMISSION"(role_id, resource_id, permission_id, created_user_id, enabled) VALUES(4, 18, 10, 1, 0);

-- Permission to Delete News in News Manager
INSERT INTO "MKTG_PLANNING_TOOL"."ROLE_PERMISSION"(role_id, resource_id, permission_id, created_user_id, enabled) VALUES(4, 18, 11, 1, 0);

--***************************************************************************************
-- Update schema version
INSERT INTO SCHEMA_VERSION(VERSION, DESCRIPTION, SCRIPT)
VALUES('V5.0.0-111', 'Create News tables, add permissions for Superadmin', 'V201801050955__Create_news_manager.sql');

COMMIT;