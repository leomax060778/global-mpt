PROCEDURE "MKTG_PLANNING_TOOL"."mktgplanningtool.db.procedures::GET_ALLOCATION_COUNTRY_CATEGORY_OPTION_LEVEL_TO_DELETE" (
    IN optionList TABLE(
                in_allocation_country_category_option_id integer
        		),
    IN in_l2_id integer,
    IN in_level_id integer,
    OUT out_result  TABLE(
                        NAME NVARCHAR(255),
                       allocation_country_category_option_id integer
                    )
)
	LANGUAGE SQLSCRIPT
	SQL SECURITY INVOKER
	DEFAULT SCHEMA "MKTG_PLANNING_TOOL" AS
BEGIN
	out_result = select AO.NAME, ACOL.ALLOCATION_COUNTRY_CATEGORY_OPTION_ID
        from ALLOCATION_COUNTRY_CATEGORY_OPTION_LEVEL_HL2 ACOL2
        INNER JOIN ALLOCATION_COUNTRY_CATEGORY_OPTION_LEVEL ACOL on ACOL2.ALLOCATION_COUNTRY_CATEGORY_OPTION_LEVEL_ID = ACOL.ALLOCATION_COUNTRY_CATEGORY_OPTION_LEVEL_ID
            AND ACOL2.HL2_ID = in_l2_id
        INNER JOIN ALLOCATION_COUNTRY_CATEGORY_OPTION AO ON AO.ALLOCATION_COUNTRY_CATEGORY_OPTION_ID = ACOL.ALLOCATION_COUNTRY_CATEGORY_OPTION_ID
        WHERE ACOL.ALLOCATION_COUNTRY_CATEGORY_OPTION_ID
            NOT IN (SELECT in_allocation_country_category_option_id FROM :optionList)
        AND ACOL.DELETED = 0 AND ACOL.ENABLED = 1
        AND ACOL.HIERARCHY_LEVEL_ID = in_level_id;
END;
