PROCEDURE "MKTG_PLANNING_TOOL"."mktgplanningtool.db.procedures::GET_COUNTRY_CATEGORY_OPTION_BY_NAME_AND_CRM_KEY" (
    IN in_name NVARCHAR(255),
    IN in_crm_key NVARCHAR(50),
    IN in_allocation_country_category_option_id integer, -- case 0, default find
	OUT out_result TABLE (
	allocation_country_category_option_id BIGINT
	, name NVARCHAR(60)
	, crm_key NVARCHAR(50)
 	)
 	)
	LANGUAGE SQLSCRIPT
	SQL SECURITY INVOKER
	DEFAULT SCHEMA "MKTG_PLANNING_TOOL"
	READS SQL DATA AS
BEGIN

		out_result = SELECT allocation_country_category_option_id, name, crm_key FROM ALLOCATION_COUNTRY_CATEGORY_OPTION
		WHERE (upper(trim(NAME)) = upper(trim(in_name))
		or upper(trim(CRM_KEY)) = upper(trim(in_crm_key)))
		AND enabled = 1 AND deleted = 0
		--find another record with the same name or key and different id
		and (allocation_country_category_option_id <> in_allocation_country_category_option_id or 0 = in_allocation_country_category_option_id)
		ORDER BY name;

END;
